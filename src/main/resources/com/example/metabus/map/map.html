<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>Kakao Map</title>
	<link rel="stylesheet" href="style.css" />
</head>
<body>
	<div id="map"></div>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=10bb6b4f7e2c5ce60d5c3ae617ea2aa8"></script>
	<script>
		const DEFAULT_POSITION = new kakao.maps.LatLng(36.145895067603114, 128.39279933712692);
		const MAX_MARKER_CNT = 10;
		const MARKER_ARRAY = [
			new kakao.maps.MarkerImage('/mark.png', new kakao.maps.Size(40, 40)),
			new kakao.maps.MarkerImage('/mark-red.png', new kakao.maps.Size(40, 40)),
			new kakao.maps.MarkerImage('/mark-blue.png', new kakao.maps.Size(40, 40))
		];

		

		// map 생성
		var mapContainer = document.getElementById('map'),
			mapOption = { 
				// center: new kakao.maps.LatLng(33.450701, 126.570667),
				center: new kakao.maps.LatLng(36.145895067603114, 128.39279933712692),
				level: 5
			};
		var map = new kakao.maps.Map(mapContainer, mapOption);
		
		// 현재 위치를 map center로 지정
		// if (navigator.geolocation) {
		// 	navigator.geolocation.getCurrentPosition(function(position) {
		// 		var lat = position.coords.latitude,
		// 			lng = position.coords.longitude;
				
		// 		var locPosition = new kakao.maps.LatLng(lat, lng);
		// 		map.setCenter(locPosition);
		// 	});
			
		// } else {
		// 	var locPosition = new kakao.maps.LatLng(36.145895067603114, 128.39279933712692)
		// 	map.setCenter(locPosition);   
		// }

		// 알림 마커 생성
		var pin = new kakao.maps.Marker({ 
			position: DEFAULT_POSITION
		});
		pin.setMap(map);

		let pinContent = '<h6>1회 클릭 시 마커 색상이 바뀌며<br>3회 클릭 시 마커가 삭제됩니다.<br>본 마커는 클릭 시 사라집니다.</h6>'
		var pinInfo = new kakao.maps.InfoWindow({
			position : map.getCenter(),
			content : pinContent 
		});
		pinInfo.open(map, pin);

		kakao.maps.event.addListener(pin, 'click', function() {
			pinInfo.close();
			pin.setMap(null);
		});


		// 마커 제어
		var markersCnt = 0,
			selectedMarker = null;

		kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
			if(markersCnt < MAX_MARKER_CNT){
				let latlng = mouseEvent.latLng;
				let marker = new kakao.maps.Marker({
					position: DEFAULT_POSITION,
					image: MARKER_ARRAY[0]
				});
				marker.setPosition(latlng);
				marker.setMap(map);
				marker.setDraggable(true);
				kakao.maps.event.addListener(marker, 'click', function(){
					selectedMarker = marker;
					changeColor();
				});
				markersCnt++;
			}
		});

		function changeColor() {
			let curImg = selectedMarker.getImage(),
				nextImg;
			if(curImg == MARKER_ARRAY[0]){
				selectedMarker.setImage(MARKER_ARRAY[1]);
				
			}
			if(curImg == MARKER_ARRAY[1]){
				selectedMarker.setImage(MARKER_ARRAY[2]);
			}
			if(curImg == MARKER_ARRAY[2]){
				selectedMarker.setMap(null);
				markersCnt--;
			}
		}

	</script>
</body>
</html>